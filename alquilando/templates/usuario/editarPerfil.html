{% extends 'base.html' %}

{% block content %}
<div class="container mt-4" style="max-width: 500px;">
    <h2 class="text-center mb-2">Editar Perfil</h2>
    <p class="text-center mb-3">Modifica tus datos personales.</p>

    <form id="editarForm" method="POST" action="{{ url_for('editar_perfil') }}" novalidate>
        <div class="mb-2">
            <label for="nombre" class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nombre" name="nombre" value="{{ usuario.nombre }}" required>
            <div class="invalid-feedback">El nombre solo puede contener letras.</div>
        </div>

        <div class="mb-2">
            <label for="apellido" class="form-label">Apellido</label>
            <input type="text" class="form-control" id="apellido" name="apellido" value="{{ usuario.apellido }}" required>
            <div class="invalid-feedback">El apellido solo puede contener letras.</div>
        </div>

        <div class="mb-2">
            <label for="email" class="form-label">Correo electr√≥nico</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ usuario.email }}" required>
            <div class="invalid-feedback">Correo electr√≥nico inv√°lido.</div>
        </div>

        <div class="mb-2">
            <label for="password" class="form-label">Contrase√±a</label>
            <div class="input-group">
                <input type="password" class="form-control" id="password" name="password" value="{{ usuario.password }}" required>
                <button class="btn btn-outline-secondary" type="button" id="togglePassword">üëÅ</button>
            </div>
            <div class="invalid-feedback">M√≠nimo 8 caracteres, al menos una may√∫scula y un n√∫mero.</div>
        </div>

        <div class="mb-2">
            <label for="dni" class="form-label">N¬∞ de documento/DNI</label>
            <input type="text" class="form-control" id="dni" name="dni" value="{{ usuario.dni }}" required>
            <div class="invalid-feedback">Debe tener entre 7 y 8 d√≠gitos num√©ricos.</div>
        </div>

        <div class="mb-2">
            <label for="telefono" class="form-label">Tel√©fono</label>
            <input type="text" class="form-control" id="telefono" name="telefono" value="{{ usuario.telefono }}" required>
            <div class="invalid-feedback">Ingrese un tel√©fono v√°lido.</div>
        </div>

        <div class="mb-2">
            <label for="numero_tarjeta" class="form-label">N¬∞ Tarjeta de cr√©dito</label>
            <input type="text" class="form-control" id="numero_tarjeta" name="numero_tarjeta" value="{{ usuario.numero_tarjeta }}" required>
            <div class="invalid-feedback">Debe tener exactamente 16 n√∫meros.</div>
        </div>

        <div class="mb-3">
            <label for="nacionalidad" class="form-label">Nacionalidad</label>
            <input type="text" class="form-control" id="nacionalidad" name="nacionalidad" value="{{ usuario.nacionalidad }}" required>
            <div class="invalid-feedback">Solo letras permitidas.</div>
        </div>
--------------------------
        <form action="/editarPerfil" method="POST">
            <input type="text" name="nombre" placeholder="Nombre">
            <input type="text" name="apellido" placeholder="Apellido">
            <input type="email" name="email" placeholder="Correo electr√≥nico">
            <input type="text" name="telefono" placeholder="Tel√©fono">
            <input type="password" name="contrasena" placeholder="Nueva contrase√±a">
            <button type="submit">Guardar cambios</button>
        </form>
--------------------------
    <!--    <button type="submit" class="btn btn-primary w-100">Guardar cambios</button> -->

        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert alert-success text-center mt-3">{{ messages[0] }}</div>
            {% endif %}
        {% endwith %}
    </form>

    <a href="{{ url_for('sesion_iniciada') }}" class="btn btn-secondary w-100 mt-2">Cancelar</a>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("editarForm");

    document.getElementById("togglePassword").addEventListener("click", function () {
        const passwordInput = document.getElementById("password");
        const type = passwordInput.type === "password" ? "text" : "password";
        passwordInput.type = type;
        this.textContent = type === "password" ? "üëÅ" : "üôà";
    });

    form.addEventListener("submit", function (e) {
        e.preventDefault();

        const campos = [
            { id: "nombre", regex: /^[A-Za-z]+$/, mensaje: "Nombre inv√°lido" },
            { id: "apellido", regex: /^[A-Za-z]+$/, mensaje: "Apellido inv√°lido" },
            { id: "email", regex: /^\S+@\S+\.\S+$/, mensaje: "Email inv√°lido" },
            { id: "password", regex: /^(?=.*[A-Z])(?=.*\d).{8,}$/, mensaje: "Contrase√±a inv√°lida" },
            { id: "dni", regex: /^\d{7,8}$/, mensaje: "DNI inv√°lido" },
            { id: "telefono", regex: /^\d{6,16}$/, mensaje: "Tel√©fono inv√°lido" },
            { id: "numero_tarjeta", regex: /^\d{16}$/, mensaje: "Tarjeta inv√°lida" },
            { id: "nacionalidad", regex: /^[A-Za-z]+$/, mensaje: "Nacionalidad inv√°lida" }
        ];

        let valido = true;

        campos.forEach(campo => {
            const input = document.getElementById(campo.id);
            if (!campo.regex.test(input.value.trim())) {
                input.classList.add("is-invalid");
                valido = false;
            } else {
                input.classList.remove("is-invalid");
            }
        });

        if (valido) form.submit();
    });
});
</script>
{% endblock %}
